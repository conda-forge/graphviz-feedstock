From ac1061b118d3d300dc47f41b0186d4335754c326 Mon Sep 17 00:00:00 2001
From: Nehal J Wani <nehaljw.kkd1@gmail.com>
Date: Mon, 15 Feb 2021 15:17:59 -0500
Subject: [PATCH 2/7] Add CMake option: INSTALL_DEPENDENCY_DLLS (default: off)

---
 CMakeLists.txt              |  8 +++++++-
 cmd/tools/CMakeLists.txt    |  4 ++--
 lib/gvc/CMakeLists.txt      |  2 +-
 plugin/gd/CMakeLists.txt    |  2 +-
 plugin/pango/CMakeLists.txt | 14 +++++++-------
 5 files changed, 18 insertions(+), 12 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 065e96c87..3ae295add 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -18,6 +18,10 @@ option(with_cxx_api    "enables building the C++ API" OFF)
 option(with_cxx_tests  "enables building the C++ tests" OFF)
 option(use_win_pre_inst_libs "enables building using pre-installed Windows libraries" ON)
 
+if (WIN32)
+    option(INSTALL_DEPENDENCY_DLLS "Install 3rd party dependencies" OFF)
+endif (WIN32)
+
 if (with_digcola)
     add_definitions(-DDIGCOLA)
 endif (with_digcola)
@@ -244,7 +248,9 @@ if (use_coverage)
 endif()
 
 # ============================ Packaging information ===========================
-include(InstallRequiredSystemLibraries)
+if (WIN32 AND INSTALL_DEPENDENCY_DLLS)
+    include(InstallRequiredSystemLibraries)
+endif()
 include(package_info)
 include(CPack)
 
diff --git a/cmd/tools/CMakeLists.txt b/cmd/tools/CMakeLists.txt
index 8d7b88484..f7c220793 100644
--- a/cmd/tools/CMakeLists.txt
+++ b/cmd/tools/CMakeLists.txt
@@ -392,14 +392,14 @@ tool_defaults(sccmap)
 
 # ===================== Install third party DLLs on Windows ====================
 
-if (WIN32 AND EXPAT_FOUND)
+if (WIN32 AND INSTALL_DEPENDENCY_DLLS AND EXPAT_FOUND)
     install(
         FILES ${EXPAT_RUNTIME_LIBRARIES}
         DESTINATION ${BINARY_INSTALL_DIR}
     )
 endif(WIN32 AND EXPAT_FOUND)
 
-if (WIN32)
+if (WIN32 AND INSTALL_DEPENDENCY_DLLS)
     install(
         FILES ${Getopt_RUNTIME_LIBRARIES}
         DESTINATION ${BINARY_INSTALL_DIR}
diff --git a/lib/gvc/CMakeLists.txt b/lib/gvc/CMakeLists.txt
index 745841176..222ea4630 100644
--- a/lib/gvc/CMakeLists.txt
+++ b/lib/gvc/CMakeLists.txt
@@ -134,7 +134,7 @@ set_target_properties(gvc PROPERTIES
 )
 
 # Include DLLs with this library on Windows
-if (WIN32 AND EXPAT_FOUND)
+if (WIN32 AND EXPAT_FOUND AND INSTALL_DEPENDENCY_DLLS)
     install(
         FILES
             ${EXPAT_RUNTIME_LIBRARIES}
diff --git a/plugin/gd/CMakeLists.txt b/plugin/gd/CMakeLists.txt
index fe7ed264d..50a9224ac 100644
--- a/plugin/gd/CMakeLists.txt
+++ b/plugin/gd/CMakeLists.txt
@@ -36,7 +36,7 @@ install(
 )
 
 # Include DLLs with this library on Windows
-if (WIN32)
+if (WIN32 AND INSTALL_DEPENDENCY_DLLS)
     install(
         FILES
             ${GD_RUNTIME_LIBRARIES}
diff --git a/plugin/pango/CMakeLists.txt b/plugin/pango/CMakeLists.txt
index c423dd934..e5f5e2758 100644
--- a/plugin/pango/CMakeLists.txt
+++ b/plugin/pango/CMakeLists.txt
@@ -42,13 +42,13 @@ install(
 )
 
 # Include DLLs with this library on Windows
-if (WIN32)
-    install(
-        FILES
-            ${Cairo_RUNTIME_LIBRARIES}
-            ${PangoCairo_RUNTIME_LIBRARIES}
-        DESTINATION ${BINARY_INSTALL_DIR}
-    )
+if (WIN32 AND INSTALL_DEPENDENCY_DLLS)
+   install(
+       FILES
+           ${Cairo_RUNTIME_LIBRARIES}
+          ${PangoCairo_RUNTIME_LIBRARIES}
+       DESTINATION ${BINARY_INSTALL_DIR}
+   )
 endif()
 
 # Specify library version and soversion
-- 
2.31.1

