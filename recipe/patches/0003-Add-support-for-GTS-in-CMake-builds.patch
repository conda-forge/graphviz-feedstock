From 3669d4ec0894dadbfc9e855478f58a9c0d4928bb Mon Sep 17 00:00:00 2001
From: Nehal J Wani <nehaljw.kkd1@gmail.com>
Date: Tue, 16 Feb 2021 18:38:18 -0500
Subject: [PATCH 3/3] Add support for GTS in CMake builds

---
 cmake/config_checks.cmake   | 1 +
 config-cmake.h.in           | 1 +
 lib/neatogen/CMakeLists.txt | 7 +++++++
 3 files changed, 9 insertions(+)

diff --git a/cmake/config_checks.cmake b/cmake/config_checks.cmake
index fc51a68f7..11948af0e 100644
--- a/cmake/config_checks.cmake
+++ b/cmake/config_checks.cmake
@@ -42,6 +42,7 @@ check_type_size( intptr_t    INTPTR_T    )
 set( HAVE_ANN       ${ANN_FOUND}        )
 set( HAVE_EXPAT     ${EXPAT_FOUND}      )
 set( HAVE_LIBGD     ${GD_FOUND}         )
+set( HAVE_GTS       ${GTS_FOUND}        )
 set( HAVE_ZLIB      ${ZLIB_FOUND}       )
 
 if(LTDL_FOUND)
diff --git a/config-cmake.h.in b/config-cmake.h.in
index 3406882cb..a16d0733d 100644
--- a/config-cmake.h.in
+++ b/config-cmake.h.in
@@ -51,6 +51,7 @@ typedef int ssize_t;
 #cmakedefine HAVE_GD_FREETYPE
 #cmakedefine HAVE_GD_GIF
 #cmakedefine HAVE_ZLIB
+#cmakedefine HAVE_GTS
 
 // Values
 #define BROWSER "@BROWSER@"
diff --git a/lib/neatogen/CMakeLists.txt b/lib/neatogen/CMakeLists.txt
index 039cfca9b..22c496d24 100644
--- a/lib/neatogen/CMakeLists.txt
+++ b/lib/neatogen/CMakeLists.txt
@@ -92,6 +92,10 @@ add_library(neatogen STATIC
   ${SOURCES}
 )
 
+target_link_libraries(neatogen PRIVATE
+    ${GTS_LIBRARY}
+    ${GLIB_LIBRARY})
+
 target_include_directories(neatogen PRIVATE
   ${GRAPHVIZ_LIB_DIR}
   ${GRAPHVIZ_LIB_DIR}/cdt
@@ -100,6 +104,9 @@ target_include_directories(neatogen PRIVATE
   ${GRAPHVIZ_LIB_DIR}/gvc
   ${GRAPHVIZ_LIB_DIR}/pack
   ${GRAPHVIZ_LIB_DIR}/pathplan
+  ${GTS_INCLUDE_DIR}
+  ${GLIB_INCLUDE_DIR}
+  ${GLIBCONFIG_INCLUDE_DIR}
 )
 
 target_link_libraries(neatogen PRIVATE
-- 
2.31.1

