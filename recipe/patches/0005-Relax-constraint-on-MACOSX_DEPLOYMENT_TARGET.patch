From 22b6d5d0421a5dea2f1e0c46e122a76a632f1a4e Mon Sep 17 00:00:00 2001
From: Nehal J Wani <nehaljw.kkd1@gmail.com>
Date: Sun, 19 May 2024 08:22:18 +0100
Subject: [PATCH 5/5] Relax constraint on MACOSX_DEPLOYMENT_TARGET

---
 macosx/build/Distribution.xml.in          | 6 ------
 macosx/build/Makefile.am                  | 2 +-
 macosx/graphviz.xcodeproj/project.pbxproj | 8 ++++----
 3 files changed, 5 insertions(+), 11 deletions(-)

diff --git a/macosx/build/Distribution.xml.in b/macosx/build/Distribution.xml.in
index e9e045764..98b334280 100644
--- a/macosx/build/Distribution.xml.in
+++ b/macosx/build/Distribution.xml.in
@@ -32,12 +32,6 @@
     <script>
     <![CDATA[
         function check() {
-            if (!(system.compareVersions(system.version.ProductVersion, '13.5') >= 0)) {
-                my.result.title = 'Install Failed';
-                my.result.message = 'Graphviz requires macOS 13.5 (Ventura) or later.';
-                my.result.type = 'Fatal';
-                return false;
-            }
             if (system.files.fileExistsAtPath('@prefix@/bin/dot')) {
                 my.result.title = 'Existing Installation of Graphviz Detected';
                 my.result.message = 'The existing installation of Graphviz in @prefix@ will be replaced.';
diff --git a/macosx/build/Makefile.am b/macosx/build/Makefile.am
index cbbdafeae..fbc5cbe79 100644
--- a/macosx/build/Makefile.am
+++ b/macosx/build/Makefile.am
@@ -80,7 +80,7 @@ $(GV_APP_BIN): ../*.m ../*.h
 	@echo
 	@echo BUILDING GRAPHVIZ APP...
 	@echo
-	$(XCODEBUILD) -project ../graphviz.xcodeproj -configuration Release ARCHS=$(ARCH)
+	$(XCODEBUILD) -project ../graphviz.xcodeproj -configuration Release ARCHS=$(ARCH) MACOSX_DEPLOYMENT_TARGET=$(MACOSX_DEPLOYMENT_TARGET)
 
 dot.pkg: $(DESTDIR)$(PREFIX)/bin/dot Scripts/postinstall
 	@echo
diff --git a/macosx/graphviz.xcodeproj/project.pbxproj b/macosx/graphviz.xcodeproj/project.pbxproj
index 4e0155a03..7c1032a3f 100644
--- a/macosx/graphviz.xcodeproj/project.pbxproj
+++ b/macosx/graphviz.xcodeproj/project.pbxproj
@@ -394,7 +394,7 @@
 					../lib/cgraph/.libs,
 					../lib/gvc/.libs,
 				);
-				MACOSX_DEPLOYMENT_TARGET = 13.5;
+				MACOSX_DEPLOYMENT_TARGET = "$(MACOSX_DEPLOYMENT_TARGET)";
 				ONLY_ACTIVE_ARCH = YES;
 				PRODUCT_NAME = Graphviz;
 				USER_HEADER_SEARCH_PATHS = (
@@ -424,7 +424,7 @@
 					../lib/cgraph/.libs,
 					../lib/gvc/.libs,
 				);
-				MACOSX_DEPLOYMENT_TARGET = 13.5;
+				MACOSX_DEPLOYMENT_TARGET = "$(MACOSX_DEPLOYMENT_TARGET)";
 				ONLY_ACTIVE_ARCH = YES;
 				PRODUCT_NAME = Graphviz;
 				USER_HEADER_SEARCH_PATHS = (
@@ -467,7 +467,7 @@
 				GCC_WARN_UNINITIALIZED_AUTOS = YES;
 				GCC_WARN_UNUSED_FUNCTION = YES;
 				GCC_WARN_UNUSED_VARIABLE = YES;
-				MACOSX_DEPLOYMENT_TARGET = 13.5;
+				MACOSX_DEPLOYMENT_TARGET = "$(MACOSX_DEPLOYMENT_TARGET)";
 				ONLY_ACTIVE_ARCH = YES;
 				SDKROOT = macosx;
 			};
@@ -502,7 +502,7 @@
 				GCC_WARN_UNINITIALIZED_AUTOS = YES;
 				GCC_WARN_UNUSED_FUNCTION = YES;
 				GCC_WARN_UNUSED_VARIABLE = YES;
-				MACOSX_DEPLOYMENT_TARGET = 13.5;
+				MACOSX_DEPLOYMENT_TARGET = "$(MACOSX_DEPLOYMENT_TARGET)";
 				ONLY_ACTIVE_ARCH = YES;
 				SDKROOT = macosx;
 			};
-- 
2.45.1

