From a1a47e752f2878e6a49092370bf5c8d395dab86c Mon Sep 17 00:00:00 2001
From: Nehal J Wani <nehaljw.kkd1@gmail.com>
Date: Sat, 31 Dec 2022 00:30:34 +0000
Subject: [PATCH 4/5] Fix dependencies for gvplugin_webp

---
 cmake/config_checks.cmake      |  1 +
 config-cmake.h.in              |  1 +
 plugin/webp/CMakeLists.txt     |  8 ++++++++
 plugin/webp/gvloadimage_webp.c | 11 -----------
 4 files changed, 10 insertions(+), 11 deletions(-)

diff --git a/cmake/config_checks.cmake b/cmake/config_checks.cmake
index 55a383fee..49ba08554 100644
--- a/cmake/config_checks.cmake
+++ b/cmake/config_checks.cmake
@@ -38,6 +38,7 @@ if(with_zlib AND ZLIB_FOUND)
   set(HAVE_ZLIB 1)
 endif()
 set(HAVE_PANGOCAIRO ${PANGOCAIRO_FOUND})
+set(HAVE_WEBP       ${WEBP_FOUND}      )
 
 if(LTDL_FOUND)
   set(ENABLE_LTDL 1)
diff --git a/config-cmake.h.in b/config-cmake.h.in
index f4535f907..f634fa2c0 100644
--- a/config-cmake.h.in
+++ b/config-cmake.h.in
@@ -42,6 +42,7 @@ typedef SSIZE_T ssize_t;
 #cmakedefine HAVE_GS
 #cmakedefine HAVE_GTS
 #cmakedefine HAVE_PANGOCAIRO
+#cmakedefine HAVE_WEBP
 
 // Values
 #define BROWSER "@BROWSER@"
diff --git a/plugin/webp/CMakeLists.txt b/plugin/webp/CMakeLists.txt
index 712befd9a..4dac34b45 100644
--- a/plugin/webp/CMakeLists.txt
+++ b/plugin/webp/CMakeLists.txt
@@ -17,8 +17,16 @@ if(WEBP_FOUND)
     ../../lib/pathplan
   )
 
+  target_include_directories(gvplugin_webp SYSTEM PRIVATE
+    ${CAIRO_INCLUDE_DIRS}/cairo
+    ${PANGOCAIRO_INCLUDE_DIRS}
+  )
+
   target_link_libraries(gvplugin_webp
+    gvc
     WebP::webp
+    ${CAIRO_LINK_LIBRARIES}
+    ${PANGOCAIRO_LINK_LIBRARIES}
   )
 
   if(CAIRO_FOUND)
diff --git a/plugin/webp/gvloadimage_webp.c b/plugin/webp/gvloadimage_webp.c
index c98355610..b0c974891 100644
--- a/plugin/webp/gvloadimage_webp.c
+++ b/plugin/webp/gvloadimage_webp.c
@@ -23,17 +23,6 @@
 #include <cairo.h>
 #include <webp/decode.h>
 
-#ifdef _MSC_VER //*dependencies
-    #pragma comment( lib, "gvc.lib" )
-    #pragma comment( lib, "glib-2.0.lib" )
-    #pragma comment( lib, "pango-1.0.lib" )
-    #pragma comment( lib, "pangocairo-1.0.lib" )
-    #pragma comment( lib, "libcairo-2.lib" )
-    #pragma comment( lib, "gobject-2.0.lib" )
-    #pragma comment( lib, "graph.lib" )
-    #pragma comment( lib, "webp.lib" )
-#endif
-
 static const char* const kStatusMessages[] = {
     "OK", "OUT_OF_MEMORY", "INVALID_PARAM", "BITSTREAM_ERROR",
     "UNSUPPORTED_FEATURE", "SUSPENDED", "USER_ABORT", "NOT_ENOUGH_DATA"
-- 
2.41.0

