From dc314eba6bdc2930c3fc2e181efcfa5258ea713a Mon Sep 17 00:00:00 2001
From: Mark Harfouche <mark.harfouche@gmail.com>
Date: Sun, 17 Mar 2024 18:59:22 -0400
Subject: [PATCH 1/5] Always use GETOPT on windows

Originally written by: Nehal J Wani <nehaljw.kkd1@gmail.com>
---
 CMakeLists.txt               | 2 +-
 cmd/edgepaint/CMakeLists.txt | 2 +-
 cmd/gvmap/CMakeLists.txt     | 4 ++--
 cmd/mingle/CMakeLists.txt    | 2 +-
 cmd/tools/CMakeLists.txt     | 4 ++--
 contrib/prune/CMakeLists.txt | 2 +-
 lib/gvpr/CMakeLists.txt      | 2 +-
 7 files changed, 9 insertions(+), 9 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index f4b41c47a..a84a221b5 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -288,7 +288,7 @@ install(FILES ${CMAKE_CURRENT_BINARY_DIR}/graphviz_version.h DESTINATION ${HEADE
 message(STATUS "Graphviz version: ${GRAPHVIZ_VERSION_FULL}")
 
 include(config_checks)
-if(NOT HAVE_GETOPT_H)
+if(WIN32 or (NOT HAVE_GETOPT_H))
   find_package(GETOPT REQUIRED)
 endif()
 include_directories(${CMAKE_CURRENT_BINARY_DIR})
diff --git a/cmd/edgepaint/CMakeLists.txt b/cmd/edgepaint/CMakeLists.txt
index ad8196e4a..c1fa55212 100644
--- a/cmd/edgepaint/CMakeLists.txt
+++ b/cmd/edgepaint/CMakeLists.txt
@@ -26,7 +26,7 @@ if(with_sfdp)
     sparse
   )
 
-  if(NOT HAVE_GETOPT_H)
+  if(WIN32 or (NOT HAVE_GETOPT_H))
     target_link_libraries(edgepaint PRIVATE ${GETOPT_LINK_LIBRARIES})
   endif()
 
diff --git a/cmd/gvmap/CMakeLists.txt b/cmd/gvmap/CMakeLists.txt
index 348cc736a..ca9325d92 100644
--- a/cmd/gvmap/CMakeLists.txt
+++ b/cmd/gvmap/CMakeLists.txt
@@ -30,7 +30,7 @@ if(with_sfdp)
     sparse
   )
 
-  if(NOT HAVE_GETOPT_H)
+  if(WIN32 or (NOT HAVE_GETOPT_H))
     target_link_libraries(cluster PRIVATE ${GETOPT_LINK_LIBRARIES})
   endif()
 
@@ -95,7 +95,7 @@ if(with_sfdp)
     sparse
   )
 
-  if(NOT HAVE_GETOPT_H)
+  if(WIN32 or (NOT HAVE_GETOPT_H))
     target_link_libraries(gvmap ${GETOPT_LINK_LIBRARIES})
   endif()
 
diff --git a/cmd/mingle/CMakeLists.txt b/cmd/mingle/CMakeLists.txt
index 20eb71c7f..c3f5e24ad 100644
--- a/cmd/mingle/CMakeLists.txt
+++ b/cmd/mingle/CMakeLists.txt
@@ -30,7 +30,7 @@ if(with_sfdp AND ANN_FOUND)
     sparse
     ${ANN_LIBRARIES}
   )
-  if(NOT HAVE_GETOPT_H)
+  if(WIN32 or (NOT HAVE_GETOPT_H))
     target_link_libraries(mingle ${GETOPT_LINK_LIBRARIES})
   endif()
 
diff --git a/cmd/tools/CMakeLists.txt b/cmd/tools/CMakeLists.txt
index b686e9c9c..b022ecaf5 100644
--- a/cmd/tools/CMakeLists.txt
+++ b/cmd/tools/CMakeLists.txt
@@ -3,7 +3,7 @@
 # - installation of executable
 # - installation of manpage
 function(tool_defaults name)
-  if(NOT HAVE_GETOPT_H)
+  if(WIN32 or (NOT HAVE_GETOPT_H))
     target_link_libraries(${name} ${GETOPT_LINK_LIBRARIES})
   endif()
 
@@ -172,7 +172,7 @@ if(GETOPT_FOUND)
   )
 endif()
 target_link_libraries(gv2gml cgraph gvc)
-if(NOT HAVE_GETOPT_H)
+  if(WIN32 or (NOT HAVE_GETOPT_H))
   target_link_libraries(gv2gml ${GETOPT_LINK_LIBRARIES})
 endif()
 install(TARGETS gv2gml RUNTIME DESTINATION ${BINARY_INSTALL_DIR})
diff --git a/contrib/prune/CMakeLists.txt b/contrib/prune/CMakeLists.txt
index 585daa0f2..d9fef74ac 100644
--- a/contrib/prune/CMakeLists.txt
+++ b/contrib/prune/CMakeLists.txt
@@ -10,7 +10,7 @@ if(GETOPT_FOUND)
   )
 endif()
 
-if(NOT HAVE_GETOPT_H)
+if(WIN32 OR (NOT HAVE_GETOPT_H))
   target_link_libraries(prune PRIVATE ${GETOPT_LINK_LIBRARIES})
 endif()
 
diff --git a/lib/gvpr/CMakeLists.txt b/lib/gvpr/CMakeLists.txt
index 98a093f1f..71f8c2677 100644
--- a/lib/gvpr/CMakeLists.txt
+++ b/lib/gvpr/CMakeLists.txt
@@ -53,6 +53,6 @@ target_link_libraries(gvpr
   vmalloc
 )
 
-if(NOT HAVE_GETOPT_H)
+if(WIN32 OR (NOT HAVE_GETOPT_H))
   target_link_libraries(gvpr ${GETOPT_LINK_LIBRARIES})
 endif()
-- 
2.43.2

